### 过滤器

- SessionManagementFilter

  限制一个用户开启多个会话

- UsernamePasswordAuthenticationFilter

  认证校验登录表单

- ExceptionTranslationFilter

  异常处理器
  
- SecurityContextPersistenceFilter     

  在session中保存或更新一个SecurityContext，为后续Filter建立上下文

- FilterSecurityInterceptor

  方法级权限过滤器，获取所配置资源访问的授权信息，根据SecurityContext中的用户信息判断是否有权限访问

- BasicAuthenticationFilter

  权限过滤器，自动解析HTTP请求头为Authtication且以Basic开头的头信息

- WebAsyncManager

  继承SecurityContext到Spring异步执行机制中的WebAsyncManager

- SecutityContextHolderAwareRequestFilter

  包装了ServletRequest，丰富其API

**鉴权核心逻辑**

通过username和password构建UsernamePasswordAuthenticationToken，然后调用authenticate方法去验证。实现此方法的是AuthenticationManagerr的一个子类 ProviderManager。该子类中有一个AuthenticationProvider的List成员对象，AuthenticationProvider对象封装了所有的认证方式。遍历此List集合对象后会找到正确的认证方式，执行authenticate方法（和上面的authentication重名），此方法由实现AuthenticationProvider接口的子类AbstractUserDetailsAuthenticationProvider去完成。在此方法中会根据执行this.retieveUser方法（参数是username和UsernamePasswordAuthenticationToken，此方法由子类DaoAuthenticationProvider提供）获取UserDetails对象。此对象由子类DaoAuthenticationProvider的userDetailService成员对象的loadUserByUsername方法从数据库中查询得到。从数据库中查询用户名和加密后的密码以及权限构建UserDetail对象。用户拥有的权限被封装成一个储存GrantedAuthority对象的List。GrantedAuthority有一个SimpleGrantedAuthority子类，可以根据字符串构造，其角色必须以ROLE_开头

![](E:\学习笔记\typora\img\security.jpg)

**过滤器如何加载**

DelegatingFilterProxy -> 执行doFilter里面的代码初始化· -> 默认从上下文获取FilterChainProxy的Bean -> 执行这个Bean的doFilter加载所有过滤器（过滤器被封装在SecurityFilterChain对象中）
