## 服务器节点类型

- leader 可读可写

- follower 只负责读，还可参与选举

- observer 可以读，但无法选举

## ZAB协议（原子广播协议）

Zookeeper 客户端会随机的链接到 zookeeper 集群中的一个节点，如果是读请求，就直接从当前节点中读取数据；如果是写请求，那么节点就会向 Leader 提交事务，Leader 接收到事务提交，会广播该事务，只要超过半数节点写入成功，该事务就会被提交。

四种状态

1. Looking 选举状态
2. Following 
3. Leading
4. Observing

**选举机制：**

*选举时使用的是BIO通信模式*

### Epoch：逻辑时钟

或者叫投票的次数，同一轮投票过程中的逻辑时钟值是相同的。每投完一次票这个数据就会增加，然后与接收到的其它服务器返回的投票信息中的数值相比，根据不同的值做出不同的判断。

"选票"包括myid和事务zid，每个节点内部先比较事务zid，投给zid大的节点，如果zid一样选myid大的节点

假设有2个节点，每个节点内有一个投票箱，第一轮先生成自己的选票，发送给其他节点

每个节点比较选票，结束后投票箱中都只有一张票，没有超过总节点半数

第二轮投票把第一轮选出的票继续放入投票箱，此时就超过了半数

###  主从数据同步

![image-20220111211955458](E:\学习笔记\typora\img\image-20220111211955458.png)

## CAP理论

一个分布式系统只能满足一致性、可用性、分区容错性三个中的两个。zk满足了CP