## 三次握手

![img](E:\学习笔记\typora\img\KZWJ3]10{MMKQV21J3AYF26.png)

- 第一次握手确保了服务端知道客户端的发送功能正常，自己的接收功能正常
- 第二次握手确保了客户端知道了自己的发送接收功能正常，服务端的发送接收正常
- 第三次握手确保了服务端知道了自己的发送功能正常，客户端的接收功能正常。

**SYN洪泛攻击**

由于三次连接前两次会携带SYN连接，第三次不会。如果攻击者一致发送SYN请求，服务器就会维护大量TCP连接不释放，且重发ACK响应，占用资源。

## 四次挥手

![image-20220216184540492](E:\学习笔记\typora\img\image-20220216184540492.png)

==ack表示希望下次对方发送来的seq序号。是由本次接收到的对方seq序号 + 本次接收到的数据包长度得到的。==

**大量TIME-WAIT和CLOSE-WAIT连接的原因？**

1. 主要由于服务器端主动关闭连接，比如高并发场景

​	第一个场景：HTTP 没有使用长连接

​	第二个场景：HTTP 长连接超时

​	第三个场景：HTTP 长连接的请求数量达到上限

2. 当服务端出现大量 CLOSE_WAIT 状态的连接的时候，通常都是代码的问题，这时候我们需要针对具体的代码一步一步的进行排查和定位，主要分析的方向就是服务端为什么没有调用 close。

