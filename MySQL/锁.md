## MyISAM

**表锁：**

加锁 lock table tb_name read/write;

解锁 unlock tables

**读锁会阻塞写，但是不会阻塞读，但是写锁会把读和写的都阻塞。**

一个客户端持有读锁后不能从其他表读取数据和改写数据，同时其他客户端向读锁锁住的表插入数据时会阻塞

```sql
show open tables 查看表锁
show status like 'table%' 两个变量记录获取锁和等待锁的次数
```

## innodb

索引失效会导致行锁变表锁

**间隙锁：**
 用范围条件检索数据，InnoDB会给符合条件的行加锁，在范围内但不存在的记录叫做间隙

这个间隙也会被加上锁，则此时无法插入间隙的数据

show status like 'innodb_row_lock%'

==如何锁定一行？==

select xxx from table for update

==问：事务1改变了数据，事务2如果不提交是看不到数据变化的，这就叫可重复读隔离级别，为什么事务1改变数据加上写锁事务2还能读取数据呢？==

答：innodb采用了"一致性非锁定读"的机制提高了数据库并发性。一致性非锁定读表示在如果当前行被施加了排他锁，那么当需要读取行数据时，则不会等待行上的锁的释放，而是会去读取一个快照数据

### 其他锁

![image-20220314213018009](E:\学习笔记\typora\img\image-20220314213018009.png)



### 疑问

update会锁表吗？

如果没有索引，所以update会锁表，如果加了索引，就会锁行